<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="game.css" />
    <!-- <script src="game.js"></script> -->
</head>
<body>
    <div class="wrapper">
    <div class="player"></div>
    </div>
    



    <script>
    var player = document.querySelector('.player')
    var playerPositionX = parseInt(window.getComputedStyle(player).getPropertyValue('left'))
    
    var playerRadius = parseInt(window.getComputedStyle(player).getPropertyValue('width'));


    var board = document.querySelector('.wrapper')
    var direction = 0;
    var position = 0;
    var event = 0;
    var meteorSpeed = 0;
    var meteors = [];
    const randomPos = Math.ceil(Math.random() * 910);
    const randomSpeed = Math.ceil(Math.random() * 3);
    var beginAt = Date.now()
    var lastMeteorTime = beginAt;
    var meteorDTime = Math.random() * 3000;  
// var meteor = null;
// update ();




  update();
  function update() {
    var now = Date.now()
    
    if (now - lastMeteorTime > meteorDTime) {
      createMeteor()
    lastMeteorTime = now
}
    
    meteors.forEach(function (meteor) {
      var top = parseFloat(window.getComputedStyle(meteor).top);
      var left = parseFloat(window.getComputedStyle(meteor).left);
      var playerPositionX = parseInt(window.getComputedStyle(player).getPropertyValue('left'))
      var playerPositionY = parseInt(window.getComputedStyle(player).getPropertyValue('top'));
      
      if (left >= playerPositionX - playerRadius/2 && left <= playerPositionX + playerRadius/2 && 
        top >= playerPositionY - playerRadius) {
          return
      }
      top += meteor.speed;
      if (top > board.clientHeight) {
        meteor.remove()
      }
      

      meteor.style.top = top + 'px';
    })
   

    movePlayer();

    requestAnimationFrame(update);
  }



window.addEventListener('keydown', function(event){
var key = event.code

if (key === 'ArrowRight') {
 direction = 3;
 
}

if (key === 'ArrowLeft') {
    direction = -3;
}


})

window.addEventListener('keyup', function (event){
var key = event.code

if (key === 'ArrowRight') {
    direction = 0;
}
if (key === 'ArrowLeft') {
    direction = 0;
}

})



function createMeteor() {

  
    var meteor = document.createElement('div')
    meteor.classList.add('meteor')
    meteor.speed = Math.ceil(Math.random() * 3)
    meteor.style.left = Math.random() * 650 + 'px';
    board.appendChild(meteor)
    // meteors.push(meteor)
    meteors.push(meteor);
   

}

function putMeteorOnBoard(meteor, board) {
meteor.style.left = Math.random() * 650 + 'px';
board.appendChild(meteor)
}


 function kickMeteor(meteor) {
    // setTimeout(function () {
    //   meteors = meteors.filter(function (falling) {
    //     return meteor !== falling;
    //   })
    //   meteor.remove();
    // }, Math.random() * 3000 + 5000);
    // if (meteor.top > board.clientHeight) {
    //     meteor.remove();
    // }
    meteors.push(meteor);
    meteors.sort((a, b) => a.speed - b.speed).forEach(meteor => board.appendChild(meteor));
  }


// showMeteorAfterTime(5000);

  function showMeteorAfterTime(time) {
      
    setTimeout(function () {
      var meteor = createMeteor();
      putMeteorOnBoard(meteor, board);
      kickMeteor(meteor);
      showMeteorAfterTime(Math.random() * 1000);
    }, time);

  }







// setInterval(function(){


function movePlayer() {
    var left = parseFloat(window.getComputedStyle(player).getPropertyValue('left'));
    left += direction
    player.style.left = left + 'px'
    // position += direction
    //   player.style.left = position + 'px';

      if (position < 0) {
            position = 0 }

             if (position >= 910) {
                position = 910
            }

            

        }
            


// }, 1)

        



// function update() {

//     function move(direction) {
//         position += direction
//         player.style.marginLeft = position + 'px';
//     }
    

//     console.log(direction)

//     requestAnimationFrame(update);

    </script>
</body>
</html>